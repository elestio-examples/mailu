<a href="https://elest.io">
  <img src="https://elest.io/images/elestio.svg" alt="elest.io" width="150" height="75">
</a>

[![Discord](https://img.shields.io/static/v1.svg?logo=discord&color=f78A38&labelColor=083468&logoColor=ffffff&style=for-the-badge&label=Discord&message=community)](https://discord.gg/4T4JGaMYrD "Get instant assistance and engage in live discussions with both the community and team through our chat feature.")
[![Elestio examples](https://img.shields.io/static/v1.svg?logo=github&color=f78A38&labelColor=083468&logoColor=ffffff&style=for-the-badge&label=github&message=open%20source)](https://github.com/elestio-examples "Access the source code for all our repositories by viewing them.")
[![Blog](https://img.shields.io/static/v1.svg?color=f78A38&labelColor=083468&logoColor=ffffff&style=for-the-badge&label=elest.io&message=Blog)](https://blog.elest.io "Latest news about elestio, open source software, and DevOps techniques.")

# Mailu, verified and packaged by Elestio

[Mailu](https://github.com/Mailu/Mailu) is a simple yet full-featured mail server as a set of Docker images. It is free software (both as in free beer and as in free speech), open to suggestions and external contributions. The project aims at providing people with an easily setup, easily maintained and full-featured mail server while not shipping proprietary software nor unrelated features often found in popular groupware.

<img src="https://github.com/elestio-examples/mailu/raw/main/Mailu.jpg" alt="mailu" width="800">

Deploy a <a target="_blank" href="https://elest.io/open-source/mailu">fully managed mailu</a> on <a target="_blank" href="https://elest.io/">elest.io</a> if you want automated backups, reverse proxy with SSL termination, firewall, automated OS & Software updates, and a team of Linux experts and open source enthusiasts to ensure your services are always safe, and functional.

[![deploy](https://github.com/elestio-examples/mailu/raw/main/deploy-on-elestio.png)](https://dash.elest.io/deploy?source=cicd&social=dockerCompose&url=https://github.com/elestio-examples/mailu)

# Why use Elestio images?

- Elestio stays in sync with updates from the original source and quickly releases new versions of this image through our automated processes.
- Elestio images provide timely access to the most recent bug fixes and features.
- Our team performs quality control checks to ensure the products we release meet our high standards.

# Usage

## Git clone

You can deploy it easily with the following command:

    git clone https://github.com/elestio-examples/mailu.git

Copy the .env file from tests folder to the project directory

    cp ./tests/.env ./.env

Edit the .env file with your own values.

Create data folders with correct permissions



Run the project with the following command

    docker-compose up -d

You can access the Web UI at: `http://your-domain:15672`

## Docker-compose

Here are some example snippets to help you get started creating a container.

# This file is auto-generated by the Mailu configuration wizard.
# Please read the documentation before attempting any change.
# Generated for compose flavor

    version: '3.3'

        services:

        # External dependencies
        redis:
            image: redis:alpine
            restart: always
            volumes:
                - "./mailuredis:/data"
            depends_on:
                - resolver
            dns:
                - 192.168.203.254
            
            
        roundcubemail:
            image: roundcube/roundcubemail:latest
            restart: always
            volumes:
                - ./rc/www:/var/www/html
                - ./rc/db/sqlite:/var/roundcube/db
            ports:
                - 172.17.0.1:9002:80
            environment:
                - ROUNDCUBEMAIL_DB_TYPE=sqlite
                - ROUNDCUBEMAIL_SKIN=elastic
                - ROUNDCUBEMAIL_DEFAULT_HOST=172.17.0.1
                - ROUNDCUBEMAIL_SMTP_SERVER=172.17.0.1

        # Core services
        front:
            image: elestio4test/mailu-nginx:${SOFTWARE_VERSION_TAG}
            restart: always
            env_file: .env
            logging:
                driver: journald
                options:
                    tag: mailu-front
            ports:
                - "172.17.0.1:8002:80"
                - "172.17.0.1:2443:443"
                - "${SYSTEM_IP}:25:25"
                - "172.17.0.1:465:465"
                - "172.17.0.1:587:587"
                - "172.17.0.1:110:110"
                - "172.17.0.1:995:995"
                - "172.17.0.1:143:143"
                - "172.17.0.1:993:993"
            networks:
                - default
                - radicale
            volumes:
                - "./mailucerts:/certs"
                - "./mailuoverrides/nginx:/overrides:ro"
            depends_on:
                - resolver
            dns:
                - 192.168.203.254

        resolver:
            image: elestio4test/mailu-unbound:${SOFTWARE_VERSION_TAG}
            env_file: .env
            restart: always
            networks:
                default:
                    ipv4_address: 192.168.203.254

        admin:
            image: elestio4test/mailu-admin:${SOFTWARE_VERSION_TAG}
            restart: always
            env_file: .env
            logging:
                driver: journald
                options:
                    tag: mailu-admin
            volumes:
                - "./mailudata:/data"
                - "./mailudkim:/dkim"
            depends_on:
                - redis
                - resolver
            dns:
                - 192.168.203.254

        imap:
            image: elestio4test/mailu-dovecot:${SOFTWARE_VERSION_TAG}
            restart: always
            env_file: .env
            logging:
                driver: journald
                options:
                    tag: mailu-imap
            volumes:
                - "./mailumail:/mail"
                - "./mailuoverrides/dovecot:/overrides:ro"
            depends_on:
                - front
                - resolver
            dns:
                - 192.168.203.254

        smtp:
            image: elestio4test/mailu-postfix:${SOFTWARE_VERSION_TAG}
            restart: always
            env_file: .env
            logging:
                driver: journald
                options:
                    tag: mailu-smtp
            volumes:
                - "./mailumailqueue:/queue"
                - "./mailuoverrides/postfix:/overrides:ro"
            depends_on:
                - front
                - resolver
            dns:
                - 192.168.203.254

        oletools:
            image: elestio4test/mailu-oletools:${SOFTWARE_VERSION_TAG}
            hostname: oletools
            restart: always
            networks:
                - noinet
            depends_on:
                - resolver
            dns:
                - 192.168.203.254

        antispam:
            image: elestio4test/mailu-rspamd:${SOFTWARE_VERSION_TAG}
            hostname: antispam
            restart: always
            env_file: .env
            logging:
                driver: journald
                options:
                    tag: mailu-antispam
            networks:
                - default
                - noinet
            volumes:
                - "./mailufilter:/var/lib/rspamd"
                - "./mailuoverrides/rspamd:/overrides:ro"
            depends_on:
                - front
                - redis
                - oletools
                - antivirus
                - resolver
            dns:
                - 192.168.203.254

        # Optional services
        antivirus:
            image: elestio4test/mailu-clamav:${SOFTWARE_VERSION_TAG}
            restart: always
            env_file: .env
            volumes:
                - "./mailufilter:/data"
            depends_on:
                - resolver
            dns:
                - 192.168.203.254

        webdav:
            image: elestio4test/mailu-radicale:${SOFTWARE_VERSION_TAG}
            restart: always
            volumes:
                - "./mailudav:/data"
            networks:
                - radicale

        fetchmail:
            image: elestio4test/mailu-fetchmail:${SOFTWARE_VERSION_TAG}
            restart: always
            env_file: .env
            volumes:
                - "./mailudata/fetchmail:/data"
            depends_on:
                - admin
                - smtp
                - imap
                - resolver
            dns:
                - 192.168.203.254

        networks:
        default:
            driver: bridge
            ipam:
                driver: default
                config:
                    - subnet: 192.168.203.0/24
        radicale:
            driver: bridge
        noinet:
            driver: bridge
            internal: true


# Maintenance

## Logging

The Elestio Mailu Docker image sends the container logs to stdout. To view the logs, you can use the following command:

    docker-compose logs -f

To stop the stack you can use the following command:

    docker-compose down

## Backup and Restore with Docker Compose

To make backup and restore operations easier, we are using folder volume mounts. You can simply stop your stack with docker-compose down, then backup all the files and subfolders in the folder near the docker-compose.yml file.

Creating a ZIP Archive
For example, if you want to create a ZIP archive, navigate to the folder where you have your docker-compose.yml file and use this command:

    zip -r myarchive.zip .

Restoring from ZIP Archive
To restore from a ZIP archive, unzip the archive into the original folder using the following command:

    unzip myarchive.zip -d /path/to/original/folder

Starting Your Stack
Once your backup is complete, you can start your stack again with the following command:

    docker-compose up -d

That's it! With these simple steps, you can easily backup and restore your data volumes using Docker Compose.

# Links

- <a target="_blank" href="https://github.com/Mailu/Mailu">Mailu Github repository</a>

- <a target="_blank" href="https://mailu.io/2.0/#">Mailu documentation</a>

- <a target="_blank" href="https://github.com/elestio-examples/mailu">Elestio/Mailu Github repository</a>
